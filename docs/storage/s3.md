---
title: Amazon S3
createTime: 2025/11/09 00:26:55
permalink: /storage/s3
---
# Amazon S3 é…ç½®æŒ‡å—

è¯¦ç»†çš„ Amazon S3 é…ç½®æ­¥éª¤å’Œæœ€ä½³å®è·µã€‚

## æ¦‚è¿°

Amazon S3ï¼ˆSimple Storage Serviceï¼‰æ˜¯ä¸šç•Œæ ‡å‡†çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- ğŸ¢ ä¼ä¸šçº§æœåŠ¡
- ğŸ” æœ€é«˜çš„å®‰å…¨æ€§
- ğŸ“Š åŠŸèƒ½æœ€å®Œæ•´
- ğŸŒ å…¨çƒå¯ç”¨
- ğŸ“ˆ è‡ªåŠ¨æ‰©å±•

## è´¦æˆ·è®¾ç½®

### 1. åˆ›å»º AWS è´¦æˆ·

è®¿é—® [AWS å®˜ç½‘](https://aws.amazon.com/) åˆ›å»ºè´¦æˆ·ã€‚æ–°ç”¨æˆ·äº«å— 12 ä¸ªæœˆå…è´¹å¥—é¤ã€‚

### 2. è®¿é—® S3 æ§åˆ¶å°

1. ç™»å½• AWS ç®¡ç†æ§åˆ¶å°
2. æœç´¢ "S3"
3. è¿›å…¥ S3 æœåŠ¡

## åˆ›å»ºå­˜å‚¨æ¡¶

### 1. åˆ›å»ºæ–°æ¡¶

1. ç‚¹å‡» "åˆ›å»ºå­˜å‚¨æ¡¶"
2. è¾“å…¥å­˜å‚¨æ¡¶åç§°ï¼ˆä¾‹å¦‚ `my-cloud-storage`ï¼‰
   - åç§°å¿…é¡»å…¨å±€å”¯ä¸€
   - åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦å’Œç‚¹
3. é€‰æ‹©åŒºåŸŸï¼ˆä¾‹å¦‚ `ap-northeast-1` ä¸œäº¬ï¼‰
4. **ACL** - ä¿æŒé»˜è®¤ï¼ˆç¦ç”¨ï¼‰
5. **é˜»æ­¢å…¬æœ‰è®¿é—®è®¾ç½®** - æ ¹æ®éœ€æ±‚é…ç½®ï¼ˆè§ä¸‹ä¸€æ­¥ï¼‰
6. ç‚¹å‡» "åˆ›å»ºå­˜å‚¨æ¡¶"

### 2. é…ç½®å…¬å¼€è®¿é—®ï¼ˆå¯é€‰ï¼‰

è‹¥è¦è®©æ–‡ä»¶å¯ä»¥å…¬å¼€è®¿é—®ï¼š

1. è¿›å…¥å­˜å‚¨æ¡¶ â†’ "æƒé™"
2. æ‰¾åˆ° "é˜»æ­¢å…¬æœ‰è®¿é—®" éƒ¨åˆ†
3. ç‚¹å‡» "ç¼–è¾‘"
4. **å–æ¶ˆå‹¾é€‰** "é˜»æ­¢æ‰€æœ‰å…¬æœ‰è®¿é—®"
5. ç‚¹å‡» "ä¿å­˜"

### 3. å¯ç”¨ ACLï¼ˆä»…åœ¨éœ€è¦æ—¶ï¼‰

1. è¿›å…¥å­˜å‚¨æ¡¶ â†’ "æƒé™"
2. æ‰¾åˆ° "å¯¹è±¡æ‰€æœ‰æƒ" éƒ¨åˆ†
3. ç‚¹å‡» "ç¼–è¾‘"
4. é€‰æ‹© "ACL å·²å¯ç”¨"
5. ç‚¹å‡» "ä¿å­˜"

## åˆ›å»º IAM ç”¨æˆ·å’Œå‡­è¯

### 1. åˆ›å»º IAM ç”¨æˆ·

ä½¿ç”¨ IAM ç”¨æˆ·è€Œä¸æ˜¯æ ¹è´¦æˆ·æ›´å®‰å…¨ï¼š

1. è¿›å…¥ IAM æ§åˆ¶å°
2. å·¦ä¾§èœå• â†’ "ç”¨æˆ·"
3. ç‚¹å‡» "åˆ›å»ºç”¨æˆ·"
4. è¾“å…¥ç”¨æˆ·åï¼ˆä¾‹å¦‚ `Cloud Index-user`ï¼‰
5. ç‚¹å‡» "åˆ›å»ºç”¨æˆ·"

### 2. é…ç½®æƒé™

#### æ–¹å¼ Aï¼šä½¿ç”¨æ‰˜ç®¡ç­–ç•¥ï¼ˆæ¨èï¼‰

1. è¿›å…¥ç”¨æˆ·è¯¦æƒ…
2. ç‚¹å‡» "æ·»åŠ æƒé™" â†’ "ç›´æ¥é™„åŠ ç°æœ‰ç­–ç•¥"
3. æœç´¢ "AmazonS3FullAccess"
4. å‹¾é€‰å¹¶ç‚¹å‡» "ä¸‹ä¸€æ­¥"
5. ç‚¹å‡» "æ·»åŠ æƒé™"

#### æ–¹å¼ Bï¼šä½¿ç”¨è‡ªå®šä¹‰ç­–ç•¥ï¼ˆæ›´å®‰å…¨ï¼‰

1. è¿›å…¥ç”¨æˆ·è¯¦æƒ…
2. ç‚¹å‡» "æ·»åŠ æƒé™" â†’ "åˆ›å»ºå†…è”ç­–ç•¥"
3. é€‰æ‹© JSON
4. ç²˜è´´ä»¥ä¸‹ç­–ç•¥ï¼š

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListAllMyBuckets",
                "s3:GetBucketLocation"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetObjectVersion",
                "s3:ListBucketVersions"
            ],
            "Resource": "arn:aws:s3:::my-cloud-storage"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::my-cloud-storage/*"
        }
    ]
}
```

5. ç‚¹å‡» "åˆ›å»ºç­–ç•¥"

### 3. åˆ›å»ºè®¿é—®å¯†é’¥

1. è¿›å…¥ç”¨æˆ·è¯¦æƒ…
2. ç‚¹å‡» "å®‰å…¨å‡­è¯" é€‰é¡¹å¡
3. å‘ä¸‹æ»šåŠ¨åˆ° "è®¿é—®å¯†é’¥"
4. ç‚¹å‡» "åˆ›å»ºè®¿é—®å¯†é’¥"
5. é€‰æ‹© "å…¶ä»–"
6. ç‚¹å‡» "ä¸‹ä¸€æ­¥"
7. å¤åˆ¶ **Access Key ID** å’Œ **Secret Access Key**
8. ä¿å­˜åˆ°å®‰å…¨ä½ç½®

**âš ï¸ é‡è¦**: å¯†é’¥åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·ç«‹å³ä¿å­˜ï¼

## é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# å­˜å‚¨ç±»å‹
STORAGE_TYPE=s3

# AWS å‡­è¯
ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# S3 é…ç½®
S3_BUCKET_NAME=my-cloud-storage
S3_REGION=ap-northeast-1

# å¯é€‰ï¼šå…¬å¼€è®¿é—®é…ç½®
S3_PUBLIC_URL=https://my-cloud-storage.s3.ap-northeast-1.amazonaws.com

# å¯é€‰ï¼šé¢„ç­¾å URL è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤ 3600ï¼‰
S3_PRESIGN_EXPIRES=3600
```

## å¸¸ç”¨ AWS åŒºåŸŸ

é€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼š

| åŒºåŸŸä»£ç  | ä½ç½® | è¯´æ˜ |
|---------|------|------|
| `us-east-1` | ç¾å›½ä¸œéƒ¨ï¼ˆN. Virginiaï¼‰ | ç¾å›½ |
| `us-west-2` | ç¾å›½è¥¿éƒ¨ï¼ˆOregonï¼‰ | ç¾å›½è¥¿æµ·å²¸ |
| `eu-west-1` | æ¬§æ´²ï¼ˆIrelandï¼‰ | æ¬§æ´² |
| `ap-northeast-1` | äºšå¤ªï¼ˆTokyoï¼‰ | æ—¥æœ¬ã€éŸ©å›½ |
| `ap-southeast-1` | äºšå¤ªï¼ˆSingaporeï¼‰ | ä¸œå—äºš |
| `cn-north-1` | ä¸­å›½ï¼ˆåŒ—äº¬ï¼‰ | ä¸­å›½ |

## é…ç½®å…¬å¼€è®¿é—® URL

### æ–¹å¼ Aï¼šä½¿ç”¨ S3 é»˜è®¤ URL

```env
S3_PUBLIC_URL=https://bucket-name.s3.region.amazonaws.com
```

### æ–¹å¼ Bï¼šä½¿ç”¨ CloudFront CDN

1. è¿›å…¥ CloudFront æ§åˆ¶å°
2. ç‚¹å‡» "åˆ›å»ºåˆ†é…"
3. æºåŸŸåï¼šé€‰æ‹©ä½ çš„ S3 å­˜å‚¨æ¡¶
4. å…¶ä»–è®¾ç½®ä¿æŒé»˜è®¤
5. ç‚¹å‡» "åˆ›å»ºåˆ†é…"
6. ç­‰å¾…éƒ¨ç½²ï¼ˆçº¦ 15-20 åˆ†é’Ÿï¼‰
7. å¤åˆ¶åˆ†é…åŸŸå

é…ç½®ç¯å¢ƒå˜é‡ï¼š

```env
S3_PUBLIC_URL=https://d123abc456.cloudfront.net
```

### æ–¹å¼ Cï¼šä½¿ç”¨è‡ªå®šä¹‰åŸŸå

1. ä½¿ç”¨ Route 53 æˆ–å…¶ä»– DNS æœåŠ¡
2. åˆ›å»º CNAME è®°å½•æŒ‡å‘ S3 æˆ– CloudFront
3. é…ç½® SSL è¯ä¹¦

```env
S3_PUBLIC_URL=https://assets.example.com
```

## å¯ç”¨ CORSï¼ˆå¦‚éœ€è·¨åŸŸè¯·æ±‚ï¼‰

1. è¿›å…¥å­˜å‚¨æ¡¶
2. ç‚¹å‡» "æƒé™"
3. å‘ä¸‹æ»šåŠ¨åˆ° "CORS"
4. ç‚¹å‡» "ç¼–è¾‘"
5. ç²˜è´´ä»¥ä¸‹é…ç½®ï¼š

```json
[
    {
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["GET", "PUT", "POST", "DELETE", "HEAD"],
        "AllowedOrigins": ["*"],
        "ExposeHeaders": ["ETag"]
    }
]
```

6. ç‚¹å‡» "ä¿å­˜æ›´æ”¹"

## å¯ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼ˆå¯é€‰ï¼‰

1. è¿›å…¥å­˜å‚¨æ¡¶
2. ç‚¹å‡» "å±æ€§"
3. æ‰¾åˆ° "ç‰ˆæœ¬æ§åˆ¶"
4. ç‚¹å‡» "ç¼–è¾‘"
5. é€‰æ‹© "å¯ç”¨"
6. ç‚¹å‡» "ä¿å­˜æ›´æ”¹"

## å¯ç”¨ç”Ÿå‘½å‘¨æœŸè§„åˆ™ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰

è‡ªåŠ¨åˆ é™¤è¿‡æœŸæ–‡ä»¶ä»¥èŠ‚çœæˆæœ¬ï¼š

1. è¿›å…¥å­˜å‚¨æ¡¶
2. ç‚¹å‡» "ç®¡ç†"
3. ç‚¹å‡» "åˆ›å»ºç”Ÿå‘½å‘¨æœŸè§„åˆ™"
4. è¾“å…¥è§„åˆ™åç§°ï¼ˆä¾‹å¦‚ `delete-old-cache`ï¼‰
5. é…ç½®è§„åˆ™ï¼š
   - **å‰ç¼€**ï¼šå¯é€‰ï¼ˆå¦‚ `cache/`ï¼‰
   - **å¯¹è±¡å¹´é¾„**ï¼š30 å¤©ååˆ é™¤
   - **è¿‡æœŸå¯¹è±¡åˆ é™¤æ ‡è®°**ï¼šå‹¾é€‰
6. ç‚¹å‡» "åˆ›å»ºè§„åˆ™"

## è·å–å¸®åŠ©

- ğŸ“– [AWS S3 å®˜æ–¹æ–‡æ¡£](https://docs.aws.amazon.com/s3/)
- ğŸ“– [AWS SDK for Python æ–‡æ¡£](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html)
- ğŸ› [æäº¤ Issue](https://github.com/RhenCloud/Cloud-Index/issues>)
- ğŸ’¬ [è®¨è®ºåŒº](https://github.com/RhenCloud/Cloud-Index/discussions)

## ä¸‹ä¸€æ­¥

- ğŸš€ [å¿«é€Ÿå¼€å§‹](../guide/quickstart.md) - å¼€å§‹ä½¿ç”¨åº”ç”¨
- ğŸ“– [å­˜å‚¨åç«¯å¯¹æ¯”](./overview.md) - å¯¹æ¯”å…¶ä»–æœåŠ¡
- ğŸ’¾ [Cloudflare R2 é…ç½®](./r2.md) - R2 é…ç½®æŒ‡å—
